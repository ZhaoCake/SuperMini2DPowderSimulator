// 预研究报告（Typst）
// 项目：机器视觉转鼓法检测粉体流动性（2D端面透明窗）
// 日期：2025-12-27
// 作者：（填写）

#set page(
  paper: "a4",
  margin: (top: 22mm, bottom: 22mm, left: 22mm, right: 22mm),
)
#set text(
  font: "Maple Mono",
  size: 10.5pt,
  lang: "zh",
)
#set heading(numbering: "1.")
#set par(leading: 1.25em)

#align(center)[
  #text(size: 18pt, weight: "bold")[机器视觉转鼓法检测粉体流动性]
  #linebreak()
  #text(size: 14pt)[预研究报告（Pre-study）]
]

#v(10pt)

#grid(
  columns: (1fr, 1fr),
  gutter: 10pt,
)[
  *项目名称*：2D 转鼓端面透明窗粉体截面检测与评估
  
  *版本*：v0.1（预研究阶段）
]

#v(12pt)

= 摘要
本预研究面向“转鼓法（Rotating Drum）+ 机器视觉（Machine Vision）”的粉体流动性检测任务，聚焦端面透明窗条件下的截面视频，研究如何从可观测的自由表面形态与运动特征中，提取对流态（slipping / cascading / cataracting）与流动性差异敏感、可复现、易工程实现的指标。我们提出以自由表面动态倾角（动态安息角）为核心的几何特征体系，并辅以表面粗糙度、波动频域特征、事件（雪崩/塌落）统计、以及由光流近似得到的流动层活跃度指标。报告给出指标定义、计算流程、与 DEM（LIGGGHTS）高保真仿真对齐的“真值构造”方法，形成后续算法迭代与实验设计的依据。

= 1. 背景与问题定义

== 1.1 工业与研究背景
粉体在混合、造粒、包衣、干燥等工艺中广泛存在。粉体“流动性”不是单一物性，而是受粒径分布、形状、表面粗糙、含湿、静电、黏聚性、以及工况（转速、填充率、容器几何）共同影响的综合表现。

转鼓法因装置简单、可覆盖多种流态、对剪切与塌落敏感，常用于实验室表征与过程监测。若结合透明窗成像，可在不接触粉体的情况下，连续获取自由表面形态与运动信息，为“视觉无损表征”提供路径。

== 1.2 任务定义（视觉可测量量）
输入为固定相机下的转鼓端面透明窗视频（圆形窗口 ROI），目标输出包括：
- 自由表面几何：自由表面曲线 $y = f(x, t)$（或其采样点）；
- 动态倾角：$\\theta(t)$（单位：deg）；
- 流态识别或流动性指标：基于 $\\theta(t)$、粗糙度、速度/事件等综合量化。

该问题的关键在于：视觉上无法直接得到内摩擦角、黏聚力等本构参数，因此需要构造“物理可解释的代理特征（proxy features）”，并通过 DEM 仿真或标定实验建立映射与验证。

= 2. 转鼓流态与可解释机理（预研梳理）

== 2.1 典型流态及其视觉表现
在一定填充率下，随转速（或 Froude 数）升高，典型流态依次变化：
- *Slipping / Rolling*：表面缓慢滚动或间歇小滑移；自由表面接近稳定直线，波动小。
- *Cascading*：颗粒沿表面形成较明显的滚动层，表面波动与粗糙度提升。
- *Cataracting*：颗粒被抛射后落回，出现更强的周期性与局部冲击；自由表面更不规则，事件更频繁。

== 2.2 建议用于论文/报告的无量纲描述（便于与文献对齐）
工程上常用 Froude 数表征转速强度：
$ "Fr" = omega^2 R / g $
其中 $omega$ 为角速度（rad/s），$R$ 为转鼓半径（m），$g$ 为重力加速度。更高的 $"Fr"$ 往往对应更剧烈的流态（从 cascading 向 cataracting 迁移）。

备注：本项目以像素尺度视频为主，后续可通过几何标定将像素与物理尺度对应，进而报告 $"Fr"$ 与流态阈值。

= 3. 视觉特征体系：关注哪些特征、为何有效
本节给出建议的特征“优先级与可解释性”，用于指导算法迭代。

== 3.1 核心几何特征：动态倾角 $theta(t)$

=== 3.1.1 定义
对每帧提取表面点集 ${(x_i, y_i)}_(i=1)^N$，对其做鲁棒直线拟合：
$ y = k(t) dot x + b(t) $
则动态倾角定义为：
$ theta(t) = arctan(k(t)) dot 180 / pi $

=== 3.1.2 物理含义
$theta(t)$ 反映自由表面处剪切与堆积的平衡状态；更黏聚或更不易流动的体系，可能表现为更高的平均倾角、或更强的间歇性（stick-slip）导致的角度突变。

=== 3.1.3 推荐派生统计量
- 平均：$bar(theta) = "mean"_t thin theta(t)$
- 波动：$sigma_theta = "std"_t thin theta(t)$
- 变化率：$dot(theta)(t) approx theta(t) - theta(t-1)$（帧差近似）
- 事件强度：$max_t |dot(theta)(t)|$、事件频率（超阈值次数/秒）

== 3.2 表面形态粗糙度：$R_q(t)$ 与波纹幅度

=== 3.2.1 残差 RMS（粗糙度）
给定拟合直线预测 $hat(y)_i$，残差 $r_i = y_i - hat(y)_i$，定义表面粗糙度 RMS：
$ R_q(t) = sqrt(1/N sum_(i=1)^N r_i^2) $

解释：cascading/cataracting 常带来更大的局部起伏与抛落落点造成的非线性表面，因而 $R_q$ 具有区分度。

=== 3.2.2 峰-谷幅值
将表面表示为 $y(x,t)$（按 x 采样），可定义：
$ A(t) = max_x y(x,t) - min_x y(x,t) $
该指标对局部隆起、塌落后形成的波峰/波谷敏感。

== 3.3 动力学特征：流动层活跃度与事件

=== 3.3.1 光流近似速度与流动层厚度
在粉体区域计算稠密光流 $arrow(v)(x,y,t)$（如 Farneback）。在自由表面法向方向，从表面向下搜索速度幅值衰减长度，定义阈值法流动层厚度：
$ h(t) = "mean"_x { min_d thick |arrow(v)| (x, y_s (x,t)+d, t) < tau_v } $
其中 $y_s(x,t)$ 为表面位置，$d$ 为向下深度（像素），$tau_v$ 为速度阈值。

解释：更“易流”体系通常有更活跃的表面剪切层；强黏聚可能形成整体块体滑移或间歇塌落，表现为速度场时序脉冲性。

=== 3.3.2 雪崩/塌落事件（Intermittency）
基于序列尖峰检测：
- 倾角突变：当 $|dot(theta)(t)| > tau_theta$ 且持续超过 $m$ 帧，记为事件；
- 或粗糙度尖峰：$R_q(t)$ 超阈；
- 或速度能量：$E_v(t)="mean"(|arrow(v)|)$ 的脉冲。

输出建议：事件频率（次/秒）、事件持续时间分布、事件峰值强度。

== 3.4 频域特征：主频与谱能量
对 $theta(t)$、$R_q(t)$、$E_v(t)$ 做 FFT 或 Welch 谱估计，提取：主频 $f_"peak"$、低频能量占比、高频能量占比。

解释：cataracting 往往呈更强的周期性/冲击性，频谱能量分布与主频会更显著；stick-slip 会导致低频脉冲与高峰度。

= 4. 基线算法（OpenCV 可复现方案）与关键假设

== 4.1 自由表面提取（分割 + 上沿扫描）
建议流程：
1. 圆形 ROI mask（避免背景干扰）；
2. 灰度化 + 适度滤波（高斯/双边，权衡边界清晰度）；
3. 粉体/空气分割：Otsu 或自适应阈值；
4. 对每个 x（在 ROI 内）寻找粉体最上沿 y，形成点集；
5. 用 RANSAC 拟合直线得到 $k(t), b(t)$ 与 $theta(t)$；
6. 时序平滑（EMA 或 Savitzky–Golay）抑制噪声。

== 4.2 鲁棒性要点（预研结论）
- 分割阈值应避免依赖绝对亮度（建议使用 Otsu/自适应 + ROI 归一化）；
- 拟合需鲁棒（RANSAC/Huber），以应对局部浪尖/反光/颗粒噪声；
- 时序上应控制相位延迟：EMA 简单但有滞后，SG 可保留峰值更好；
- 若存在高光弧（glare），建议在 ROI 内做高光抑制（如顶帽、亮度截断、或固定区域 mask）。

= 5. 评估指标与可视化（与工程闭环一致）

== 5.1 倾角误差指标
给定真值 $theta_"gt"(t)$ 与估计 $theta_"hat"(t)$：
- MAE：$ "MAE" = "mean"_t thin |theta_"hat"(t) - theta_"gt"(t)| $
- RMSE：$ "RMSE" = sqrt("mean"_t thin (theta_"hat"(t) - theta_"gt"(t))^2) $
- P95：$ "P95" = "percentile"_(95)(|theta_"hat" - theta_"gt"|) $

== 5.2 形态与事件指标（建议同时报告）
- $sigma_theta$（角度波动）
- $bar(R)_q$、$sigma_(R_q)$（粗糙度均值与波动）
- 事件率（events/s）、事件持续时间

== 5.3 可视化建议（面向答辩展示）
单 case 图建议 4 宫格：
1) 单帧叠加：圆边界、真值曲线、检测线（不同颜色）；
2) $theta_"gt"$ vs $theta_"hat"$ 时序；
3) 绝对误差与 MAE/RMSE/P95 统计；
4) $R_q(t)$ 与事件标记（可选叠加 $E_v(t)$）。

= 6. 与 LIGGGHTS（DEM）对齐：真值构造与标定策略

== 6.1 为什么要 DEM
视觉算法主要面对：成像退化（噪声、模糊、反光）、分割不确定性、以及“2D 截面观测”带来的信息缺失。DEM 提供粒子级真值（位置、速度、接触网络），可用于：
- 构造稳定可控的工况数据集；
- 生成更真实的表面与流动层真值；
- 用真值做参数标定（阈值、平滑强度、事件判定等）；
- 支撑论文中“验证与机理解释”。

== 6.2 DEM 侧推荐输出（与视觉特征一一对应）
1) *自由表面真值*：
- 将粒子投影到端面截面（或薄层），对 x 分箱，取 y 的上分位数（例如 95% 分位）作为表面，再平滑得到 $y_"DEM"(x,t)$。

2) *倾角真值*：
- 对 $y_"DEM"(x,t)$ 进行相同的鲁棒直线拟合，得到 $theta_"DEM"(t)$。

3) *流动层厚度真值*：
- 计算速度场或剪切率场，定义 $|v| > tau$ 或 $dot(gamma) > tau$ 区域的法向厚度 $h_"DEM"(t)$。

4) *事件真值*：
- 通过整体动能 $K(t)$、$dot(theta)_"DEM"(t)$、或上层粒子速度突变检测事件；与视觉端事件对齐。

== 6.3 标定与域适配（Sim2Real 思路）
建议采用“分层标定”：
- 第一层：几何标定（像素-物理尺度、圆心/半径/透视畸变）；
- 第二层：视觉算法参数（阈值法、RANSAC 阈值、时序平滑）；
- 第三层：指标映射（将 ${theta, R_q, h, "event_rate"}$ 映射到流动性评分/流态）。

= 7. 实验设计（预研究阶段的可执行路线）

== 7.1 变量与对照
建议的主变量：
- 工况：转速（rpm 或 $"Fr"$）、填充率（fill）；
- 粉体：粒径分布、形状/球形度、密度、摩擦系数、滚动摩擦、黏聚参数（如 JKR）；
- 成像：噪声、模糊、高光、曝光漂移。

对照原则：每次只改变一类因素，记录特征变化趋势（例如 $sigma_theta$ 随 rpm 增大是否上升）。

== 7.2 指标趋势假设（用于指导验证）
- rpm 增大：事件频率与速度能量上升，$R_q$ 增大，频谱主频更明显；
- fill 增大：几何形态与 $theta$ 可能上升，流动层厚度变化依体系而定；
- 黏聚增强：更强的间歇性（事件更“少但更大”）或整体块体滑移，导致 $|dot(theta)|$ 峰值与峰度上升。

== 7.3 数据集与复现
建议每个 case 保存：原视频、mask/中间结果（可选）、检测输出（theta/线参数/表面点）、meta（所有参数与随机种子）、报告图。

= 8. 风险点与下一步工作

== 8.1 主要风险
- 反光/阴影导致分割失败，进而影响表面点；
- 端面观测为 2D 截面，可能与真实 3D 流态存在偏差（尤其靠近壁面效应）；
- 光流在颗粒纹理不足或噪声强时不稳定。

== 8.2 近期改进方向（不引入深度学习前提）
- 自由表面提取：从“逐列上沿”升级为“能量最小分割”或“活动轮廓（snake）”的轻量版本（仍可基于 OpenCV/NumPy）；
- 高光鲁棒：固定位置 glare mask + 亮度截断 + 形态学修正；
- 事件检测：融合 $dot(theta)$、$R_q$、$E_v$ 做一致性判定，降低误检。

== 8.3 里程碑建议
- M1：完成 DEM 工况扫描与真值输出规范；
- M2：完成视觉指标与 DEM 真值对齐（误差闭环）；
- M3：形成“流动性评分”或“流态分类”在多工况下的稳定报告。

= 附录 A：符号表（建议放论文）
- $R$：转鼓半径
- $omega$：角速度
- $"Fr"$：Froude 数
- $theta(t)$：动态倾角（deg）
- $R_q(t)$：表面粗糙度 RMS（像素尺度）
- $arrow(v)$：光流速度向量（像素/帧）
- $h(t)$：流动层厚度（像素）
